<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>AMAYRA · অ্যাডমিন প্যানেল</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: #f3f4f6;
    }
    
    /* Login Page Styles */
    .login-container {
      min-height: 100vh;
      background: linear-gradient(135deg, #0A192F 0%, #1a2f4a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    
    .login-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 40px 12px 40px 12px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      padding: 2.5rem;
      width: 100%;
      max-width: 400px;
      border: 2px solid rgba(24, 119, 242, 0.2);
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .login-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #1877F2, #FF7A00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .login-input {
      width: 100%;
      padding: 1rem 1.2rem;
      border: 2px solid #e2e8f0;
      border-radius: 30px 8px 30px 8px;
      font-size: 1rem;
      transition: all 0.3s;
      margin-bottom: 1rem;
    }
    
    .login-input:focus {
      outline: none;
      border-color: #1877F2;
      box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
    }
    
    .login-btn {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #1877F2, #0a5bc4);
      color: white;
      border: none;
      border-radius: 40px 8px 40px 8px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(24, 119, 242, 0.5);
    }
    
    /* Admin Panel Styles */
    .admin-container {
      display: none;
    }
    
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 260px;
      background: #0A192F;
      color: white;
      overflow-y: auto;
      transition: all 0.3s;
      z-index: 50;
    }
    
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0 !important;
      }
    }
    
    .sidebar-logo {
      padding: 1.5rem;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-logo h2 {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #1877F2, #FF7A00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .sidebar-logo p {
      font-size: 0.7rem;
      color: #a0aec0;
    }
    
    .sidebar-menu {
      padding: 1.5rem 0;
    }
    
    .menu-item {
      padding: 0.8rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      color: #a0aec0;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }
    
    .menu-item:hover, .menu-item.active {
      background: rgba(24, 119, 242, 0.1);
      color: white;
      border-left-color: #1877F2;
    }
    
    .menu-item i {
      width: 24px;
      font-size: 1.2rem;
    }
    
    .main-content {
      margin-left: 260px;
      padding: 1.5rem;
      transition: all 0.3s;
    }
    
    @media (max-width: 768px) {
      .main-content {
        margin-left: 0;
      }
    }
    
    .top-bar {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 30px 8px 30px 8px;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .menu-toggle {
      display: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #1877F2;
    }
    
    @media (max-width: 768px) {
      .menu-toggle {
        display: block;
      }
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 30px 8px 30px 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #1877F2, #FF7A00);
      border-radius: 20px 4px 20px 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    
    .section-card {
      background: white;
      border-radius: 40px 12px 40px 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .btn-primary {
      background: #1877F2;
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: 30px 6px 30px 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
    }
    
    .btn-primary:hover {
      background: #1666d9;
      transform: translateY(-2px);
      box-shadow: 0 8px 15px -3px rgba(24, 119, 242, 0.4);
    }
    
    .btn-warning {
      background: #FF7A00;
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: 30px 6px 30px 6px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: 30px 6px 30px 6px;
    }
    
    .btn-success {
      background: #059669;
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: 30px 6px 30px 6px;
    }
    
    .data-table {
      width: 100%;
      overflow-x: auto;
    }
    
    .data-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .data-table th {
      text-align: left;
      padding: 1rem 0.5rem;
      color: #6b7280;
      font-weight: 600;
      border-bottom: 2px solid #e2e8f0;
    }
    
    .data-table td {
      padding: 1rem 0.5rem;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px 4px 20px 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-confirmed { background: #dbeafe; color: #1e40af; }
    .status-processing { background: #e0e7ff; color: #3730a3; }
    .status-shipped { background: #cffafe; color: #0e7490; }
    .status-delivered { background: #d1fae5; color: #065f46; }
    .status-cancelled { background: #fee2e2; color: #991b1b; }
    .status-approved { background: #d1fae5; color: #065f46; }
    .status-rejected { background: #fee2e2; color: #991b1b; }
    
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    
    .modal.open {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 50px 16px 50px 16px;
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #374151;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 25px 4px 25px 4px;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #1877F2;
    }
    
    .image-preview {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 25px 4px 25px 4px;
      border: 2px solid #e2e8f0;
      cursor: pointer;
    }
    
    .image-preview:hover {
      border-color: #1877F2;
    }
    
    .notification-badge {
      position: relative;
    }
    
    .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #dc2626;
      color: white;
      font-size: 0.7rem;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tab {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s;
    }
    
    .tab.active {
      border-bottom-color: #1877F2;
      color: #1877F2;
      font-weight: 600;
    }
    
    .order-detail-item {
      background: #f9fafb;
      padding: 0.75rem;
      border-radius: 20px 4px 20px 4px;
      margin-bottom: 0.5rem;
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1877F2;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #1877F2;
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div class="login-container" id="loginPage">
    <div class="login-card">
      <div class="login-header">
        <h1>AMAYRA</h1>
        <p class="text-gray-600 mt-2">অ্যাডমিন প্যানেল</p>
      </div>
      <form id="loginForm">
        <input type="text" class="login-input" id="username" placeholder="ইউজারনেম" required>
        <input type="password" class="login-input" id="password" placeholder="পাসওয়ার্ড" required>
        <button type="submit" class="login-btn">লগইন</button>
      </form>
    </div>
  </div>

  <!-- Admin Panel -->
  <div class="admin-container" id="adminPanel">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <h2>AMAYRA</h2>
        <p>অ্যাডমিন প্যানেল</p>
      </div>
      <div class="sidebar-menu">
        <div class="menu-item active" data-page="dashboard">
          <i class="fa-solid fa-chart-pie"></i>
          <span>ড্যাশবোর্ড</span>
        </div>
        <div class="menu-item" data-page="sliders">
          <i class="fa-solid fa-images"></i>
          <span>স্লাইডার</span>
        </div>
        <div class="menu-item" data-page="categories">
          <i class="fa-solid fa-tags"></i>
          <span>ক্যাটাগরি</span>
        </div>
        <div class="menu-item" data-page="products">
          <i class="fa-solid fa-shirt"></i>
          <span>প্রোডাক্ট</span>
        </div>
        <div class="menu-item" data-page="orders" id="ordersMenuItem">
          <i class="fa-solid fa-truck notification-badge">
            <span class="badge" id="orderBadge" style="display: none;">0</span>
          </i>
          <span>অর্ডার</span>
        </div>
        <div class="menu-item" data-page="reviews" id="reviewsMenuItem">
          <i class="fa-solid fa-star notification-badge">
            <span class="badge" id="reviewBadge" style="display: none;">0</span>
          </i>
          <span>রিভিউ</span>
        </div>
        <div class="menu-item" data-page="settings">
          <i class="fa-solid fa-gear"></i>
          <span>সেটিংস</span>
        </div>
        <div class="menu-item" data-page="change-password">
          <i class="fa-solid fa-key"></i>
          <span>পাসওয়ার্ড পরিবর্তন</span>
        </div>
        <div class="menu-item" id="logoutBtn">
          <i class="fa-solid fa-sign-out"></i>
          <span>লগআউট</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <div class="top-bar">
        <div class="flex items-center gap-4">
          <i class="fa-solid fa-bars menu-toggle" id="menuToggle"></i>
          <h2 class="text-xl font-bold" id="pageTitle">ড্যাশবোর্ড</h2>
        </div>
        <div class="flex items-center gap-4">
          <span class="text-sm text-gray-600" id="adminName">অ্যাডমিন</span>
        </div>
      </div>

      <!-- Dynamic Content -->
      <div id="pageContent"></div>
    </div>
  </div>

  <!-- Modal Template -->
  <div class="modal" id="modal">
    <div class="modal-content" id="modalContent"></div>
  </div>

  <script>
    // API Base URL
    const API_BASE = 'https://amayra-e7x1.onrender.com/api';
    let token = localStorage.getItem('token');
    let adminUsername = localStorage.getItem('adminUsername');

    // Check login status
    if (token) {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'block';
      document.getElementById('adminName').textContent = adminUsername || 'অ্যাডমিন';
      loadDashboard();
      loadUnreadCounts();
    }

    // Login Form
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      try {
        const res = await fetch(`${API_BASE}/admin/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await res.json();
        if (res.ok) {
          token = data.token;
          localStorage.setItem('token', token);
          localStorage.setItem('adminUsername', username);
          document.getElementById('loginPage').style.display = 'none';
          document.getElementById('adminPanel').style.display = 'block';
          document.getElementById('adminName').textContent = username;
          loadDashboard();
          loadUnreadCounts();
          setInterval(loadUnreadCounts, 30000);
        } else {
          Swal.fire('ত্রুটি', data.error || 'লগইন ব্যর্থ', 'error');
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
      }
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('token');
      localStorage.removeItem('adminUsername');
      document.getElementById('adminPanel').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
    });

    // Menu Toggle
    document.getElementById('menuToggle').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('open');
    });

    // Menu Navigation
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', async () => {
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        const page = item.dataset.page;
        document.getElementById('pageTitle').textContent = {
          dashboard: 'ড্যাশবোর্ড',
          sliders: 'স্লাইডার',
          categories: 'ক্যাটাগরি',
          products: 'প্রোডাক্ট',
          orders: 'অর্ডার',
          reviews: 'রিভিউ',
          settings: 'সেটিংস',
          'change-password': 'পাসওয়ার্ড পরিবর্তন'
        }[page] || 'ড্যাশবোর্ড';

        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
          document.getElementById('sidebar').classList.remove('open');
        }

        switch(page) {
          case 'dashboard': loadDashboard(); break;
          case 'sliders': loadSliders(); break;
          case 'categories': loadCategories(); break;
          case 'products': loadProducts(); break;
          case 'orders': loadOrders(); break;
          case 'reviews': loadReviews(); break;
          case 'settings': loadSettings(); break;
          case 'change-password': loadChangePassword(); break;
        }
      });
    });

    // Load Unread Counts
    async function loadUnreadCounts() {
      try {
        const [ordersRes, reviewsRes] = await Promise.all([
          fetch(`${API_BASE}/admin/orders/unread-count`, {
            headers: { 'Authorization': `Bearer ${token}` }
          }),
          fetch(`${API_BASE}/admin/reviews/unread-count`, {
            headers: { 'Authorization': `Bearer ${token}` }
          })
        ]);

        const ordersData = await ordersRes.json();
        const reviewsData = await reviewsRes.json();

        const orderBadge = document.getElementById('orderBadge');
        const reviewBadge = document.getElementById('reviewBadge');

        if (ordersData.count > 0) {
          orderBadge.style.display = 'flex';
          orderBadge.textContent = ordersData.count;
        } else {
          orderBadge.style.display = 'none';
        }

        if (reviewsData.count > 0) {
          reviewBadge.style.display = 'flex';
          reviewBadge.textContent = reviewsData.count;
        } else {
          reviewBadge.style.display = 'none';
        }
      } catch (error) {
        console.error('Error loading unread counts:', error);
      }
    }

    // Load Dashboard
    async function loadDashboard() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/admin/dashboard`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();

        content.innerHTML = `
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-truck"></i></div>
              <p class="text-gray-600 text-sm">মোট অর্ডার</p>
              <h3 class="text-2xl font-bold">${data.stats.totalOrders}</h3>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-clock"></i></div>
              <p class="text-gray-600 text-sm">পেন্ডিং অর্ডার</p>
              <h3 class="text-2xl font-bold">${data.stats.pendingOrders}</h3>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-shirt"></i></div>
              <p class="text-gray-600 text-sm">মোট প্রোডাক্ট</p>
              <h3 class="text-2xl font-bold">${data.stats.totalProducts}</h3>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-star"></i></div>
              <p class="text-gray-600 text-sm">মোট রিভিউ</p>
              <h3 class="text-2xl font-bold">${data.stats.totalReviews}</h3>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-hourglass-half"></i></div>
              <p class="text-gray-600 text-sm">পেন্ডিং রিভিউ</p>
              <h3 class="text-2xl font-bold">${data.stats.pendingReviews}</h3>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-bangladeshi-taka-sign"></i></div>
              <p class="text-gray-600 text-sm">মোট আয়</p>
              <h3 class="text-2xl font-bold">৳${data.stats.revenue.toLocaleString()}</h3>
            </div>
          </div>

          <div class="section-card">
            <h3 class="text-xl font-bold mb-4">সাম্প্রতিক অর্ডার</h3>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>অর্ডার ID</th>
                    <th>গ্রাহক</th>
                    <th>ফোন</th>
                    <th>মোট</th>
                    <th>স্ট্যাটাস</th>
                    <th>তারিখ</th>
                  </tr>
                </thead>
                <tbody>
                  ${data.recentOrders.map(order => `
                    <tr>
                      <td>${order.orderId}</td>
                      <td>${order.customerName}</td>
                      <td>${order.phone}</td>
                      <td>৳${order.total}</td>
                      <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                      <td>${new Date(order.createdAt).toLocaleDateString('bn-BD')}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">ডেটা লোড করতে ব্যর্থ</p>';
      }
    }

    // Load Sliders
    async function loadSliders() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/admin/sliders`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const sliders = await res.json();

        content.innerHTML = `
          <div class="section-card">
            <div class="section-header">
              <h3 class="text-xl font-bold">স্লাইডার পরিচালনা</h3>
              <button class="btn-primary" onclick="showSliderModal()">
                <i class="fa-solid fa-plus mr-2"></i>নতুন স্লাইডার
              </button>
            </div>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>ছবি</th>
                    <th>শিরোনাম</th>
                    <th>ব্যাজ</th>
                    <th>অর্ডার</th>
                    <th>স্ট্যাটাস</th>
                    <th>অ্যাকশন</th>
                  </tr>
                </thead>
                <tbody>
                  ${sliders.map(slider => `
                    <tr>
                      <td><img src="${slider.imageUrl}" class="image-preview w-12 h-12"></td>
                      <td>${slider.title}</td>
                      <td><span style="background:${slider.badgeColor}" class="px-2 py-1 text-white rounded-full text-xs">${slider.badge}</span></td>
                      <td>${slider.order}</td>
                      <td><span class="status-badge ${slider.active ? 'status-delivered' : 'status-cancelled'}">${slider.active ? 'সক্রিয়' : 'নিষ্ক্রিয়'}</span></td>
                      <td>
                        <button onclick="showSliderModal(${JSON.stringify(slider)})" class="btn-primary text-sm px-3 py-1 mr-2"><i class="fa-regular fa-pen-to-square"></i></button>
                        <button onclick="deleteSlider('${slider._id}')" class="btn-danger text-sm px-3 py-1"><i class="fa-regular fa-trash-can"></i></button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">স্লাইডার লোড করতে ব্যর্থ</p>';
      }
    }

    // Show Slider Modal
    window.showSliderModal = (slider = null) => {
      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modalContent');

      modalContent.innerHTML = `
        <h3 class="text-2xl font-bold mb-6">${slider ? 'স্লাইডার সম্পাদনা' : 'নতুন স্লাইডার'}</h3>
        <form id="sliderForm" onsubmit="saveSlider(event, '${slider?._id || ''}')">
          <div class="form-group">
            <label class="form-label">শিরোনাম</label>
            <input type="text" class="form-input" name="title" value="${slider?.title || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">সাবটাইটেল</label>
            <input type="text" class="form-input" name="subtitle" value="${slider?.subtitle || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">ব্যাজ</label>
            <input type="text" class="form-input" name="badge" value="${slider?.badge || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">ব্যাজ রঙ</label>
            <input type="color" class="form-input" name="badgeColor" value="${slider?.badgeColor || '#1877F2'}" required>
          </div>
          <div class="form-group">
            <label class="form-label">বাটন টেক্সট</label>
            <input type="text" class="form-input" name="buttonText" value="${slider?.buttonText || 'এখনই কিনুন'}" required>
          </div>
          <div class="form-group">
            <label class="form-label">প্রোডাক্ট আইডি</label>
            <input type="number" class="form-input" name="productId" value="${slider?.productId || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">অর্ডার</label>
            <input type="number" class="form-input" name="order" value="${slider?.order || '1'}" required>
          </div>
          <div class="form-group">
            <label class="form-label">ছবি</label>
            <input type="file" class="form-input" name="image" accept="image/*" ${slider ? '' : 'required'}>
            ${slider?.imageUrl ? `<img src="${slider.imageUrl}" class="image-preview mt-2">` : ''}
          </div>
          <div class="form-group">
            <label class="flex items-center gap-2">
              <input type="checkbox" name="active" ${slider?.active ? 'checked' : ''}>
              <span>সক্রিয়</span>
            </label>
          </div>
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" class="btn-secondary px-6 py-2" onclick="closeModal()">বাতিল</button>
            <button type="submit" class="btn-primary px-6 py-2">সংরক্ষণ</button>
          </div>
        </form>
      `;

      modal.classList.add('open');
    };

    // Save Slider
    window.saveSlider = async (e, id) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const data = {
        title: formData.get('title'),
        subtitle: formData.get('subtitle'),
        badge: formData.get('badge'),
        badgeColor: formData.get('badgeColor'),
        buttonText: formData.get('buttonText'),
        productId: formData.get('productId'),
        order: formData.get('order'),
        active: formData.get('active') === 'on'
      };

      const formDataToSend = new FormData();
      formDataToSend.append('data', JSON.stringify(data));
      if (formData.get('image').size > 0) {
        formDataToSend.append('image', formData.get('image'));
      }

      try {
        const url = id ? `${API_BASE}/admin/sliders/${id}` : `${API_BASE}/admin/sliders`;
        const method = id ? 'PUT' : 'POST';

        const res = await fetch(url, {
          method,
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formDataToSend
        });

        if (res.ok) {
          Swal.fire('সফল', id ? 'স্লাইডার আপডেট হয়েছে' : 'স্লাইডার তৈরি হয়েছে', 'success');
          closeModal();
          loadSliders();
        } else {
          Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
      }
    };

    // Delete Slider
    window.deleteSlider = async (id) => {
      const result = await Swal.fire({
        title: 'নিশ্চিত?',
        text: 'স্লাইডারটি মুছে ফেলা হবে!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'মুছুন',
        cancelButtonText: 'বাতিল'
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`${API_BASE}/admin/sliders/${id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (res.ok) {
            Swal.fire('মুছে ফেলা হয়েছে', '', 'success');
            loadSliders();
          } else {
            Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
          }
        } catch (error) {
          Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
        }
      }
    };

    // Load Categories
    async function loadCategories() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/admin/categories`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const categories = await res.json();

        content.innerHTML = `
          <div class="section-card">
            <div class="section-header">
              <h3 class="text-xl font-bold">ক্যাটাগরি পরিচালনা</h3>
              <button class="btn-primary" onclick="showCategoryModal()">
                <i class="fa-solid fa-plus mr-2"></i>নতুন ক্যাটাগরি
              </button>
            </div>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>নাম</th>
                    <th>বাংলা নাম</th>
                    <th>অর্ডার</th>
                    <th>স্ট্যাটাস</th>
                    <th>অ্যাকশন</th>
                  </tr>
                </thead>
                <tbody>
                  ${categories.map(cat => `
                    <tr>
                      <td>${cat.name}</td>
                      <td>${cat.banglaName}</td>
                      <td>${cat.order}</td>
                      <td><span class="status-badge ${cat.active ? 'status-delivered' : 'status-cancelled'}">${cat.active ? 'সক্রিয়' : 'নিষ্ক্রিয়'}</span></td>
                      <td>
                        <button onclick="showCategoryModal(${JSON.stringify(cat)})" class="btn-primary text-sm px-3 py-1 mr-2"><i class="fa-regular fa-pen-to-square"></i></button>
                        <button onclick="deleteCategory('${cat._id}')" class="btn-danger text-sm px-3 py-1"><i class="fa-regular fa-trash-can"></i></button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">ক্যাটাগরি লোড করতে ব্যর্থ</p>';
      }
    }

    // Show Category Modal
    window.showCategoryModal = (category = null) => {
      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modalContent');

      modalContent.innerHTML = `
        <h3 class="text-2xl font-bold mb-6">${category ? 'ক্যাটাগরি সম্পাদনা' : 'নতুন ক্যাটাগরি'}</h3>
        <form id="categoryForm" onsubmit="saveCategory(event, '${category?._id || ''}')">
          <div class="form-group">
            <label class="form-label">নাম (ইংরেজি)</label>
            <input type="text" class="form-input" name="name" value="${category?.name || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">বাংলা নাম</label>
            <input type="text" class="form-input" name="banglaName" value="${category?.banglaName || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">বিবরণ</label>
            <textarea class="form-textarea" name="description">${category?.description || ''}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label">অর্ডার</label>
            <input type="number" class="form-input" name="order" value="${category?.order || '1'}" required>
          </div>
          <div class="form-group">
            <label class="flex items-center gap-2">
              <input type="checkbox" name="active" ${category?.active ? 'checked' : ''}>
              <span>সক্রিয়</span>
            </label>
          </div>
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" class="btn-secondary px-6 py-2" onclick="closeModal()">বাতিল</button>
            <button type="submit" class="btn-primary px-6 py-2">সংরক্ষণ</button>
          </div>
        </form>
      `;

      modal.classList.add('open');
    };

    // Save Category
    window.saveCategory = async (e, id) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const data = {
        name: formData.get('name'),
        banglaName: formData.get('banglaName'),
        description: formData.get('description'),
        order: formData.get('order'),
        active: formData.get('active') === 'on'
      };

      try {
        const url = id ? `${API_BASE}/admin/categories/${id}` : `${API_BASE}/admin/categories`;
        const method = id ? 'PUT' : 'POST';

        const res = await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          Swal.fire('সফল', id ? 'ক্যাটাগরি আপডেট হয়েছে' : 'ক্যাটাগরি তৈরি হয়েছে', 'success');
          closeModal();
          loadCategories();
        } else {
          Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
      }
    };

    // Delete Category
    window.deleteCategory = async (id) => {
      const result = await Swal.fire({
        title: 'নিশ্চিত?',
        text: 'ক্যাটাগরিটি মুছে ফেলা হবে!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'মুছুন',
        cancelButtonText: 'বাতিল'
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`${API_BASE}/admin/categories/${id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (res.ok) {
            Swal.fire('মুছে ফেলা হয়েছে', '', 'success');
            loadCategories();
          } else {
            Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
          }
        } catch (error) {
          Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
        }
      }
    };

    // Load Products
    async function loadProducts() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const [productsRes, categoriesRes] = await Promise.all([
          fetch(`${API_BASE}/admin/products`, {
            headers: { 'Authorization': `Bearer ${token}` }
          }),
          fetch(`${API_BASE}/categories`, {
            headers: { 'Authorization': `Bearer ${token}` }
          })
        ]);

        const products = await productsRes.json();
        const categories = await categoriesRes.json();

        content.innerHTML = `
          <div class="section-card">
            <div class="section-header">
              <h3 class="text-xl font-bold">প্রোডাক্ট পরিচালনা</h3>
              <button class="btn-primary" onclick="showProductModal()">
                <i class="fa-solid fa-plus mr-2"></i>নতুন প্রোডাক্ট
              </button>
            </div>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>ছবি</th>
                    <th>নাম</th>
                    <th>ক্যাটাগরি</th>
                    <th>মূল্য</th>
                    <th>স্টক</th>
                    <th>বিক্রি</th>
                    <th>অ্যাকশন</th>
                  </tr>
                </thead>
                <tbody>
                  ${products.map(product => `
                    <tr>
                      <td><img src="${product.img}" class="image-preview w-12 h-12"></td>
                      <td>${product.name}</td>
                      <td>${product.category}</td>
                      <td>৳${product.price}</td>
                      <td>${product.stock}</td>
                      <td>${product.sold}</td>
                      <td>
                        <button onclick="showProductModal(${JSON.stringify(product)})" class="btn-primary text-sm px-3 py-1 mr-2"><i class="fa-regular fa-pen-to-square"></i></button>
                        <button onclick="deleteProduct('${product._id}')" class="btn-danger text-sm px-3 py-1"><i class="fa-regular fa-trash-can"></i></button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">প্রোডাক্ট লোড করতে ব্যর্থ</p>';
      }
    }

    // Show Product Modal
    window.showProductModal = async (product = null) => {
      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modalContent');

      // Get categories for dropdown
      const categoriesRes = await fetch(`${API_BASE}/categories`);
      const categories = await categoriesRes.json();

      modalContent.innerHTML = `
        <h3 class="text-2xl font-bold mb-6">${product ? 'প্রোডাক্ট সম্পাদনা' : 'নতুন প্রোডাক্ট'}</h3>
        <form id="productForm" onsubmit="saveProduct(event, '${product?._id || ''}')">
          <div class="form-group">
            <label class="form-label">প্রোডাক্ট নাম</label>
            <input type="text" class="form-input" name="name" value="${product?.name || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">বিবরণ</label>
            <input type="text" class="form-input" name="desc" value="${product?.desc || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">ক্যাটাগরি</label>
            <select class="form-select" name="category" required>
              ${categories.map(cat => `
                <option value="${cat.name}" ${product?.category === cat.name ? 'selected' : ''}>${cat.banglaName}</option>
              `).join('')}
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">মূল মূল্য</label>
            <input type="number" class="form-input" name="original" value="${product?.original || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">বিক্রয় মূল্য</label>
            <input type="number" class="form-input" name="price" value="${product?.price || ''}" required>
          </div>
          <div class="form-group">
            <label class="form-label">স্টক</label>
            <input type="number" class="form-input" name="stock" value="${product?.stock || '10'}" required>
          </div>
          <div class="form-group">
            <label class="form-label">বিক্রি হয়েছে</label>
            <input type="number" class="form-input" name="sold" value="${product?.sold || '0'}" required>
          </div>
          <div class="form-group">
            <label class="form-label">ছবি (একাধিক নির্বাচন)</label>
            <input type="file" class="form-input" name="images" accept="image/*" multiple ${product ? '' : 'required'}>
            ${product?.images ? product.images.map(img => `
              <img src="${img}" class="image-preview inline-block w-16 h-16 mr-2 mt-2">
            `).join('') : ''}
          </div>
          <div class="form-group">
            <label class="flex items-center gap-2">
              <input type="checkbox" name="featured" ${product?.featured ? 'checked' : ''}>
              <span>ফিচার্ড</span>
            </label>
          </div>
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" class="btn-secondary px-6 py-2" onclick="closeModal()">বাতিল</button>
            <button type="submit" class="btn-primary px-6 py-2">সংরক্ষণ</button>
          </div>
        </form>
      `;

      modal.classList.add('open');
    };

    // Save Product
    window.saveProduct = async (e, id) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const data = {
        name: formData.get('name'),
        desc: formData.get('desc'),
        category: formData.get('category'),
        original: formData.get('original'),
        price: formData.get('price'),
        stock: formData.get('stock'),
        sold: formData.get('sold'),
        featured: formData.get('featured') === 'on'
      };

      const formDataToSend = new FormData();
      formDataToSend.append('data', JSON.stringify(data));
      
      const images = formData.getAll('images');
      images.forEach(file => {
        if (file.size > 0) {
          formDataToSend.append('images', file);
        }
      });

      try {
        const url = id ? `${API_BASE}/admin/products/${id}` : `${API_BASE}/admin/products`;
        const method = id ? 'PUT' : 'POST';

        const res = await fetch(url, {
          method,
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formDataToSend
        });

        if (res.ok) {
          Swal.fire('সফল', id ? 'প্রোডাক্ট আপডেট হয়েছে' : 'প্রোডাক্ট তৈরি হয়েছে', 'success');
          closeModal();
          loadProducts();
        } else {
          Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
      }
    };

    // Delete Product
    window.deleteProduct = async (id) => {
      const result = await Swal.fire({
        title: 'নিশ্চিত?',
        text: 'প্রোডাক্টটি মুছে ফেলা হবে!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'মুছুন',
        cancelButtonText: 'বাতিল'
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`${API_BASE}/admin/products/${id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (res.ok) {
            Swal.fire('মুছে ফেলা হয়েছে', '', 'success');
            loadProducts();
          } else {
            Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
          }
        } catch (error) {
          Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
        }
      }
    };

    // Load Orders
    async function loadOrders() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/admin/orders`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();

        content.innerHTML = `
          <div class="section-card">
            <div class="section-header">
              <h3 class="text-xl font-bold">অর্ডার পরিচালনা</h3>
            </div>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>অর্ডার ID</th>
                    <th>গ্রাহক</th>
                    <th>ফোন</th>
                    <th>জেলা</th>
                    <th>আইটেম</th>
                    <th>মোট</th>
                    <th>স্ট্যাটাস</th>
                    <th>তারিখ</th>
                    <th>অ্যাকশন</th>
                  </tr>
                </thead>
                <tbody>
                  ${data.orders.map(order => `
                    <tr>
                      <td>${order.orderId}</td>
                      <td>${order.customerName}</td>
                      <td>${order.phone}</td>
                      <td>${order.district === 'dhaka' ? 'ঢাকা' : 'ঢাকার বাইরে'}</td>
                      <td>${order.items.length}</td>
                      <td>৳${order.total}</td>
                      <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                      <td>${new Date(order.createdAt).toLocaleDateString('bn-BD')}</td>
                      <td>
                        <button onclick="showOrderDetails(${JSON.stringify(order)})" class="btn-primary text-sm px-3 py-1 mr-2"><i class="fa-regular fa-eye"></i></button>
                        <button onclick="deleteOrder('${order._id}')" class="btn-danger text-sm px-3 py-1"><i class="fa-regular fa-trash-can"></i></button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">অর্ডার লোড করতে ব্যর্থ</p>';
      }
    }

    // Show Order Details
    window.showOrderDetails = async (order) => {
      // Mark as read
      await fetch(`${API_BASE}/admin/orders/${order._id}/read`, {
        method: 'PUT',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      loadUnreadCounts();

      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modalContent');

      modalContent.innerHTML = `
        <h3 class="text-2xl font-bold mb-4">অর্ডার বিবরণ</h3>
        <div class="space-y-4">
          <p><strong>অর্ডার ID:</strong> ${order.orderId}</p>
          <p><strong>গ্রাহক:</strong> ${order.customerName}</p>
          <p><strong>ফোন:</strong> ${order.phone}</p>
          <p><strong>জেলা:</strong> ${order.district === 'dhaka' ? 'ঢাকা' : 'ঢাকার বাইরে'}</p>
          <p><strong>ঠিকানা:</strong> ${order.address}</p>
          
          <div>
            <strong>আইটেম:</strong>
            ${order.items.map(item => `
              <div class="order-detail-item">
                ${item.name} x ${item.quantity} = ৳${item.price * item.quantity}
              </div>
            `).join('')}
          </div>
          
          <p><strong>সাবটোটাল:</strong> ৳${order.subtotal}</p>
          <p><strong>ডেলিভারি চার্জ:</strong> ৳${order.deliveryCharge}</p>
          <p><strong>মোট:</strong> ৳${order.total}</p>
          
          <div class="form-group">
            <label class="form-label">স্ট্যাটাস পরিবর্তন</label>
            <select class="form-select" id="orderStatus">
              <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>পেন্ডিং</option>
              <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>কনফার্মড</option>
              <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>প্রসেসিং</option>
              <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>শিপড</option>
              <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>ডেলিভারড</option>
              <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>বাতিল</option>
            </select>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button onclick="updateOrderStatus('${order._id}')" class="btn-primary flex-1 py-2">আপডেট</button>
            <button class="btn-secondary flex-1 py-2" onclick="closeModal()">বন্ধ</button>
          </div>
        </div>
      `;

      modal.classList.add('open');
    };

    // Update Order Status
    window.updateOrderStatus = async (id) => {
      const status = document.getElementById('orderStatus').value;

      try {
        const res = await fetch(`${API_BASE}/admin/orders/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ status })
        });

        if (res.ok) {
          Swal.fire('সফল', 'অর্ডার স্ট্যাটাস আপডেট হয়েছে', 'success');
          closeModal();
          loadOrders();
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'আপডেট ব্যর্থ', 'error');
      }
    };

    // Delete Order
    window.deleteOrder = async (id) => {
      const result = await Swal.fire({
        title: 'নিশ্চিত?',
        text: 'অর্ডারটি মুছে ফেলা হবে!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'মুছুন',
        cancelButtonText: 'বাতিল'
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`${API_BASE}/admin/orders/${id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (res.ok) {
            Swal.fire('মুছে ফেলা হয়েছে', '', 'success');
            loadOrders();
            loadUnreadCounts();
          }
        } catch (error) {
          Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
        }
      }
    };

    // Load Reviews
    async function loadReviews() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/admin/reviews`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const reviews = await res.json();

        content.innerHTML = `
          <div class="section-card">
            <div class="section-header">
              <h3 class="text-xl font-bold">রিভিউ পরিচালনা</h3>
            </div>
            <div class="mb-4 flex gap-3">
              <button class="tab active" onclick="filterReviews('all')">সকল</button>
              <button class="tab" onclick="filterReviews('pending')">পেন্ডিং</button>
              <button class="tab" onclick="filterReviews('approved')">অনুমোদিত</button>
              <button class="tab" onclick="filterReviews('rejected')">বাতিল</button>
            </div>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>নাম</th>
                    <th>জেলা</th>
                    <th>রিভিউ</th>
                    <th>রেটিং</th>
                    <th>স্ট্যাটাস</th>
                    <th>তারিখ</th>
                    <th>অ্যাকশন</th>
                  </tr>
                </thead>
                <tbody id="reviewsTableBody">
                  ${reviews.map(review => `
                    <tr>
                      <td>${review.name}</td>
                      <td>${review.address}</td>
                      <td>${review.text.substring(0, 30)}...</td>
                      <td>${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}</td>
                      <td><span class="status-badge status-${review.status}">${review.status}</span></td>
                      <td>${new Date(review.createdAt).toLocaleDateString('bn-BD')}</td>
                      <td>
                        <button onclick="showReviewDetails(${JSON.stringify(review)})" class="btn-primary text-sm px-3 py-1 mr-2"><i class="fa-regular fa-eye"></i></button>
                        <button onclick="deleteReview('${review._id}')" class="btn-danger text-sm px-3 py-1"><i class="fa-regular fa-trash-can"></i></button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">রিভিউ লোড করতে ব্যর্থ</p>';
      }
    }

    // Filter Reviews
    window.filterReviews = async (status) => {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      try {
        const res = await fetch(`${API_BASE}/admin/reviews?status=${status}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const reviews = await res.json();

        const tbody = document.getElementById('reviewsTableBody');
        tbody.innerHTML = reviews.map(review => `
          <tr>
            <td>${review.name}</td>
            <td>${review.address}</td>
            <td>${review.text.substring(0, 30)}...</td>
            <td>${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}</td>
            <td><span class="status-badge status-${review.status}">${review.status}</span></td>
            <td>${new Date(review.createdAt).toLocaleDateString('bn-BD')}</td>
            <td>
              <button onclick="showReviewDetails(${JSON.stringify(review)})" class="btn-primary text-sm px-3 py-1 mr-2"><i class="fa-regular fa-eye"></i></button>
              <button onclick="deleteReview('${review._id}')" class="btn-danger text-sm px-3 py-1"><i class="fa-regular fa-trash-can"></i></button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('Error filtering reviews:', error);
      }
    };

    // Show Review Details
    window.showReviewDetails = (review) => {
      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modalContent');

      modalContent.innerHTML = `
        <h3 class="text-2xl font-bold mb-4">রিভিউ বিবরণ</h3>
        <div class="space-y-4">
          <p><strong>নাম:</strong> ${review.name}</p>
          <p><strong>জেলা:</strong> ${review.address}</p>
          <p><strong>রিভিউ:</strong> ${review.text}</p>
          <p><strong>রেটিং:</strong> ${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}</p>
          <p><strong>স্ট্যাটাস:</strong> <span class="status-badge status-${review.status}">${review.status}</span></p>
          
          <div class="form-group">
            <label class="form-label">স্ট্যাটাস পরিবর্তন</label>
            <select class="form-select" id="reviewStatus">
              <option value="pending" ${review.status === 'pending' ? 'selected' : ''}>পেন্ডিং</option>
              <option value="approved" ${review.status === 'approved' ? 'selected' : ''}>অনুমোদন</option>
              <option value="rejected" ${review.status === 'rejected' ? 'selected' : ''}>বাতিল</option>
            </select>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button onclick="updateReviewStatus('${review._id}')" class="btn-primary flex-1 py-2">আপডেট</button>
            <button class="btn-secondary flex-1 py-2" onclick="closeModal()">বন্ধ</button>
          </div>
        </div>
      `;

      modal.classList.add('open');
    };

    // Update Review Status
    window.updateReviewStatus = async (id) => {
      const status = document.getElementById('reviewStatus').value;

      try {
        const res = await fetch(`${API_BASE}/admin/reviews/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ status })
        });

        if (res.ok) {
          Swal.fire('সফল', 'রিভিউ স্ট্যাটাস আপডেট হয়েছে', 'success');
          closeModal();
          loadReviews();
          loadUnreadCounts();
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'আপডেট ব্যর্থ', 'error');
      }
    };

    // Delete Review
    window.deleteReview = async (id) => {
      const result = await Swal.fire({
        title: 'নিশ্চিত?',
        text: 'রিভিউটি মুছে ফেলা হবে!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'মুছুন',
        cancelButtonText: 'বাতিল'
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`${API_BASE}/admin/reviews/${id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (res.ok) {
            Swal.fire('মুছে ফেলা হয়েছে', '', 'success');
            loadReviews();
            loadUnreadCounts();
          }
        } catch (error) {
          Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
        }
      }
    };

    // Load Settings
    async function loadSettings() {
      const content = document.getElementById('pageContent');
      content.innerHTML = '<div class="flex justify-center p-8"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/admin/settings`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const settings = await res.json();

        content.innerHTML = `
          <div class="section-card">
            <h3 class="text-xl font-bold mb-6">সাইট সেটিংস</h3>
            <form id="settingsForm" onsubmit="saveSettings(event)">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                  <label class="form-label">সাইট নাম</label>
                  <input type="text" class="form-input" name="siteName" value="${settings.siteName}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">সাইট টাইটেল</label>
                  <input type="text" class="form-input" name="siteTitle" value="${settings.siteTitle}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ফোন নম্বর</label>
                  <input type="text" class="form-input" name="phoneNumber" value="${settings.phoneNumber}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">হোয়াটসঅ্যাপ নম্বর</label>
                  <input type="text" class="form-input" name="whatsappNumber" value="${settings.whatsappNumber}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ইমেইল</label>
                  <input type="email" class="form-input" name="email" value="${settings.email}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ফেসবুক পেজ</label>
                  <input type="text" class="form-input" name="facebook" value="${settings.facebook}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ঠিকানা</label>
                  <input type="text" class="form-input" name="address" value="${settings.address}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ঢাকার ভেতরে ডেলিভারি চার্জ</label>
                  <input type="number" class="form-input" name="deliveryChargeDhaka" value="${settings.deliveryChargeDhaka}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ঢাকার বাইরে ডেলিভারি চার্জ</label>
                  <input type="number" class="form-input" name="deliveryChargeOutside" value="${settings.deliveryChargeOutside}" required>
                </div>
                <div class="form-group">
                  <label class="form-label">ফ্রি ডেলিভারির জন্য ন্যূনতম অর্ডার</label>
                  <input type="number" class="form-input" name="freeDeliveryThreshold" value="${settings.freeDeliveryThreshold}" required>
                </div>
                <div class="form-group md:col-span-2">
                  <label class="form-label">ফুটার টেক্সট</label>
                  <input type="text" class="form-input" name="footerText" value="${settings.footerText}" required>
                </div>
              </div>
              
              <div class="flex justify-end mt-6">
                <button type="submit" class="btn-primary px-8 py-3">সেটিংস সংরক্ষণ</button>
              </div>
            </form>
          </div>
        `;
      } catch (error) {
        content.innerHTML = '<p class="text-red-500">সেটিংস লোড করতে ব্যর্থ</p>';
      }
    }

    // Save Settings
    window.saveSettings = async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch(`${API_BASE}/admin/settings`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          Swal.fire('সফল', 'সেটিংস সংরক্ষিত হয়েছে', 'success');
        } else {
          Swal.fire('ত্রুটি', 'ব্যর্থ হয়েছে', 'error');
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
      }
    };

    // Load Change Password
    function loadChangePassword() {
      const content = document.getElementById('pageContent');
      
      content.innerHTML = `
        <div class="section-card max-w-lg mx-auto">
          <h3 class="text-xl font-bold mb-6">পাসওয়ার্ড পরিবর্তন</h3>
          <form id="changePasswordForm" onsubmit="changePassword(event)">
            <div class="form-group">
              <label class="form-label">বর্তমান পাসওয়ার্ড</label>
              <input type="password" class="form-input" name="currentPassword" required>
            </div>
            <div class="form-group">
              <label class="form-label">নতুন পাসওয়ার্ড</label>
              <input type="password" class="form-input" name="newPassword" required>
            </div>
            <div class="form-group">
              <label class="form-label">নতুন পাসওয়ার্ড (আবার)</label>
              <input type="password" class="form-input" name="confirmPassword" required>
            </div>
            <button type="submit" class="btn-primary w-full py-3">পাসওয়ার্ড পরিবর্তন করুন</button>
          </form>
        </div>
      `;
    }

    // Change Password
    window.changePassword = async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const currentPassword = formData.get('currentPassword');
      const newPassword = formData.get('newPassword');
      const confirmPassword = formData.get('confirmPassword');

      if (newPassword !== confirmPassword) {
        Swal.fire('ত্রুটি', 'নতুন পাসওয়ার্ড মেলেনি', 'error');
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/admin/change-password`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });

        if (res.ok) {
          Swal.fire('সফল', 'পাসওয়ার্ড পরিবর্তন হয়েছে', 'success');
          e.target.reset();
        } else {
          const data = await res.json();
          Swal.fire('ত্রুটি', data.error || 'ব্যর্থ হয়েছে', 'error');
        }
      } catch (error) {
        Swal.fire('ত্রুটি', 'সার্ভার সংযোগ ব্যর্থ', 'error');
      }
    };

    // Close Modal
    window.closeModal = () => {
      document.getElementById('modal').classList.remove('open');
    };
  </script>
</body>
</html>